<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Highlighting Logic Test</title>
</head>
<body>
    <h1>Highlighting Logic Test</h1>
    
    <h2>Test Cases:</h2>
    <div id="results"></div>

    <script>
        // Copy of the improved highlighting logic from AiAssistant.tsx
        function testKeyHighlighting(question) {
            const lowerQuestion = question.toLowerCase();
            const keyWords = ['n√∏kkel', 'n√∏kler', 'sertifikat', 'certificate', 'jwk', 'jwt', 'kryptografi', 'crypto'];
            const expiredWords = ['utl√∏pt', 'expired', 'expire', 'utl√∏per', 'expiry', 'utl√∏p', 'gammel', 'old', 'invalid', 'ugyldig'];
            const problemWords = ['problem', 'feil', 'error', 'issue', 'trouble', 'ikke fungerer', 'virker ikke'];
            
            // Extended scope exclusion list
            const scopeWords = [
                'scope', 'scopes', 'access token', 'access_token', 'tilgang',
                'autorisasjon', 'authorization', 'levetid', 'lifetime',
                'logger ut', 'logges ut', 'logout', 'innstilling', 'klientens',
                'brukeren', 'session', 'sesjon'
            ];
            const hasScopeWord = scopeWords.some(word => lowerQuestion.includes(word));
            
            const hasExplicitKeyWord = keyWords.some(word => lowerQuestion.includes(word));
            const hasKeyProblem = hasExplicitKeyWord && (expiredWords.some(word => lowerQuestion.includes(word)) || problemWords.some(word => lowerQuestion.includes(word)));
            
            if (hasScopeWord) {
                return { highlight: false, reason: 'Scope-related question - key highlighting skipped', matchedScopeWords: scopeWords.filter(word => lowerQuestion.includes(word)) };
            }
            
            const shouldHighlightKeys = hasExplicitKeyWord || hasKeyProblem;
            return { 
                highlight: shouldHighlightKeys, 
                reason: shouldHighlightKeys ? 'Key-specific question' : 'Not about keys',
                hasExplicitKeyWord,
                hasKeyProblem
            };
        }

        function testScopeHighlighting(question) {
            const lowerQuestion = question.toLowerCase();
            const scopeConflictWords = [
                'access token', 'access_token', 'tilgang', 
                'autorisasjon', 'authorization', 
                'levetid', 'lifetime', 
                'logger ut', 'logges ut', 'logout',
                'scope', 'scopes', 'innstilling', 'klientens'
            ];
            const conflictWords = [
                'konflikt', 'problem', 'feil', 'utl√∏per', 'f√∏r', 'tidligere',
                'mindre', 'lavere', 'kortere', 'tidligere enn', 'korte'
            ];
            
            const hasScopeConflictWord = scopeConflictWords.some(word => lowerQuestion.includes(word));
            const hasConflictWord = conflictWords.some(word => lowerQuestion.includes(word));
            
            const isAccessTokenIssue = lowerQuestion.includes('access token') || lowerQuestion.includes('access_token');
            const isLifetimeIssue = lowerQuestion.includes('levetid') || lowerQuestion.includes('lifetime') || lowerQuestion.includes('utl√∏per');
            const isClientSettingIssue = lowerQuestion.includes('innstilling') || lowerQuestion.includes('klientens');
            
            const shouldHighlight = hasScopeConflictWord && hasConflictWord || 
                                  (isAccessTokenIssue && isLifetimeIssue) ||
                                  (isLifetimeIssue && isClientSettingIssue);
            
            return {
                highlight: shouldHighlight,
                reason: shouldHighlight ? 'Scope conflict detected' : 'No scope conflict',
                hasScopeConflictWord,
                hasConflictWord,
                isAccessTokenIssue,
                isLifetimeIssue,
                isClientSettingIssue
            };
        }

        // Test cases
        const testCases = [
            "Access tokens utl√∏per f√∏r klientens innstilling",
            "Hvilke scopes har denne klienten?",
            "Mine n√∏kler har utl√∏pt",
            "Klient med noen scopes p√• som logger ut brukeren lenge f√∏r det jeg har satt levetid til",
            "JWK certificate er expired",
            "Scope lifetime konflikt",
            "Problem med autorisasjonslevetid",
            "N√∏kkelen virker ikke"
        ];

        const resultsDiv = document.getElementById('results');
        
        testCases.forEach((testCase, index) => {
            const keyResult = testKeyHighlighting(testCase);
            const scopeResult = testScopeHighlighting(testCase);
            
            const testDiv = document.createElement('div');
            testDiv.style.marginBottom = '20px';
            testDiv.style.padding = '10px';
            testDiv.style.border = '1px solid #ccc';
            
            testDiv.innerHTML = `
                <h3>Test ${index + 1}: "${testCase}"</h3>
                <p><strong>Key Highlighting:</strong> ${keyResult.highlight ? 'üîë YES' : '‚ùå NO'} - ${keyResult.reason}</p>
                ${keyResult.matchedScopeWords ? `<p>Matched scope words: ${keyResult.matchedScopeWords.join(', ')}</p>` : ''}
                <p><strong>Scope Highlighting:</strong> ${scopeResult.highlight ? 'üîç YES' : '‚ùå NO'} - ${scopeResult.reason}</p>
                <details>
                    <summary>Detailed Analysis</summary>
                    <p>Key Analysis: ${JSON.stringify(keyResult, null, 2)}</p>
                    <p>Scope Analysis: ${JSON.stringify(scopeResult, null, 2)}</p>
                </details>
            `;
            
            resultsDiv.appendChild(testDiv);
        });
    </script>
</body>
</html>
